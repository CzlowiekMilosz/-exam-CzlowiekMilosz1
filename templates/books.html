{% extends "base.html" %}

{% block content %}
<div class="row">
  <div class="col-md-10 offset-md-1">
    <h1>Books</h1>
    
    {% if books %}
      <div class="table-responsive">
        <table class="table table-striped mt-4">
          <thead>
            <tr>
              <th>Title</th>
              <th>Author</th>
              <th>Year</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for book in books %}
            <tr id="book-{{ book.id }}">
              <td>{{ book.title }}</td>
              <td>{{ book.author }}</td>
              <td>{{ book.year if book.year else 'N/A' }}</td>
              <td>
                <button
                  class="btn btn-sm btn-danger delete-btn"
                  data-id="{{ book.id }}"
                  type="button"
                >
                  Delete
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="alert alert-info mt-4">No books in your library yet. <a href="{{ url_for('index') }}">Search for books</a></p>
    {% endif %}
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
  document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      const bookId = btn.getAttribute('data-id');
      
      try {
        const response = await fetch(`/books/delete/${bookId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.status === 'ok') {
            // Remove the row from the DOM
            document.getElementById(`book-${bookId}`).remove();
          }
        } else if (response.status === 404) {
          alert('Book not found');
        } else {
          alert('Error deleting book');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error deleting book');
      }
    });
  });
</script>
{% endblock %}
